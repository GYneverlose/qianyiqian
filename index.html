<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ç­¾ä¸€ç­¾ v0.4 Â· æ°´å¢¨æµ‹è¯•ç‰ˆ</title>
<style>
  body{margin:0;background:#f6f3ea url('https://images.unsplash.com/photo-1520699514109-9a2583cdd61e?auto=format&fit=crop&w=1400&q=60') center/cover fixed no-repeat; color:#1a1a1a; font-family: "Noto Serif SC", system-ui, serif;}
  header{position:sticky;top:0;background:#ffffffcc;backdrop-filter: blur(6px);border-bottom:1px solid #e6e0cf;padding:10px 14px;display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-weight:600;letter-spacing:.2em}
  .paper{max-width:1100px;margin:14px auto;display:grid;grid-template-columns:1.2fr .8fr;gap:14px;padding:0 14px}
  .panel{background:rgba(255,255,255,.9);border:1px solid #e6e0cf;border-radius:12px;padding:14px;box-shadow:0 4px 20px rgba(0,0,0,.06)}
  .btn{display:inline-block;border:1px solid #b89c6b;background:linear-gradient(#fff,#f3ead6);padding:10px 16px;border-radius:10px;cursor:pointer;margin-right:8px}
  .btn:hover{filter:brightness(.98)}
  .inkbtn{border:2px solid #2c2c2c;background:#fff;box-shadow: inset 0 0 0 2px #00000010, 2px 2px 0 #00000020}
  .result{border:1px dashed #d9cfb6;border-radius:10px;padding:12px;background:#fffaf1;margin-top:10px}
  .poem{font-size:18px;color:#834;letter-spacing:1px}
  .tip{color:#444;margin-top:6px}
  .stat{display:inline-flex;gap:6px;background:#fff;border:1px solid #e6e0cf;padding:8px 10px;border-radius:10px;margin-left:8px}
  .grid{display:grid;grid-template-columns:repeat(8,1fr);gap:6px}
  .cell{text-align:center;border:1px solid #e6e0cf;border-radius:8px;background:#fff;padding:8px 4px;position:relative}
  .cell .rar{position:absolute;left:4px;top:3px;font-size:10px;color:#888}
  .rar-R{box-shadow: inset 0 0 0 2px #e0e0e0}
  .rar-SR{box-shadow: inset 0 0 0 2px #9dc2a6}
  .rar-SSR{box-shadow: inset 0 0 0 2px #caa85a}
  .rar-SSSR{box-shadow: inset 0 0 0 2px #b26aa2}
  .glow{animation:glow 1.6s ease-in-out infinite alternate}
  @keyframes glow{from{text-shadow:0 0 3px #f6d36b}to{text-shadow:0 0 14px #ffd26f}}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#2c2c2c;color:#fff;padding:10px 16px;border-radius:10px;display:none}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:20}
  .dialog{background:#fffaf1;border:1px solid #e6e0cf;border-radius:12px;max-width:520px;padding:16px 18px;text-align:center}
  .tabs{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
  .tab{padding:6px 10px;border:1px solid #c8bfa9;border-radius:999px;cursor:pointer;background:#fff}
  .tab.active{background:#f3ead6}
  .idiom{display:flex;justify-content:space-between;border:1px solid #e6e0cf;background:#fff;border-radius:10px;padding:8px 10px;margin-top:6px}
  .idiom.done{background:#f4fff4;border-color:#a6d8a6}
  small.disclaimer{color:#777}
</style>
</head>
<body>
<header>
  <div><h1>ç­¾ ä¸€ ç­¾ Â· æ°´å¢¨æµ‹  v0.4</h1>
  <small class="disclaimer">ç­¾æ–‡éæ³¨å®šï¼Œä»…ä¾›å‚è€ƒï¼Œå‘½è¿æœªå®šï¼Œä¿¡å¿µè‡ªèº«ã€‚</small></div>
  <div>
    <span class="stat">å‘½è¿å€¼ï¼š<b id="mv">0</b></span>
    <span class="stat">é‡‘ç¨»ï¼š<b id="gold">0</b>ï½œæ—¥äº§ï¼š<b id="gyield">0</b></span>
  </div>
</header>

<div class="paper">
  <div class="panel">
    <div class="tabs" id="pools"></div>
    <div class="panel" style="background:#fffef7;border-style:dashed">
      <div class="btn inkbtn" id="ritualBtn">æ‘‡ç­¾å‰çš„ä»ªå¼</div>
      <div class="btn inkbtn" id="drawBtn">æ‘‡ç­¾</div>
      <div class="btn inkbtn" id="redoBtn">æˆ‘é‡ç­¾ï¼ˆè®¢é˜…æ¨¡æ‹Ÿï¼‰</div>
      <div class="result" id="result" style="display:none">
        <div class="poem" id="poem"></div>
        <div class="tip" id="tip"></div>
        <div class="tip">ç­¾çº§ï¼š<span id="tier"></span>ï½œå‘½è¿å€¼å˜åŒ–ï¼š<b id="mvDelta"></b></div>
      </div>
    </div>

    <div class="panel">
      <h3>æŠ½å­—å¡</h3>
      <div>
        <span class="btn inkbtn" id="drawCard">æŠ½ä¸€å¼ </span>
        <small>ï¼ˆå‘½è¿å€¼ -10ï¼‰</small>
      </div>
      <div id="cardHint" class="tip"></div>
      <div class="grid" id="inv"></div>
    </div>
  </div>

  <div class="panel">
    <h3>ğŸ¯ è—ç»é˜</h3>
    <div id="idiomBox"></div>
    <div style="margin-top:10px">
      <span class="btn inkbtn" id="harvest">æ”¶å‰²é‡‘ç¨»</span>
      <small>24h å†·å´ï¼Œä¸Šæ¬¡ï¼š<span id="lastHarvest">â€”</span></small>
    </div>
  </div>
</div>

<div class="modal" id="ritual">
  <div class="dialog">
    <h3>ä»ªå¼ Â· é™å¿ƒä¸‰æ¯</h3>
    <p>é—­ä¸Šçœ¼ï¼Œé»˜æƒ³ä½ æƒ³è¯¢é—®çš„äº‹ã€‚å¸â€”â€”å‘¼â€”â€”ä¸‰æ¬¡ã€‚</p>
    <p>å½“ä½ å‡†å¤‡å¥½äº†ï¼Œè½»ç‚¹ä¸‹é¢çš„æŒ‰é’®å¼€å§‹æ‘‡ç­¾ã€‚</p>
    <div class="btn" id="startRitual">å¼€å§‹æ‘‡ç­¾</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<audio id="s_bell" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7f9e3b8b35.mp3?filename=small-bell-99307.mp3" preload="auto"></audio>
<audio id="s_qin" src="https://cdn.pixabay.com/download/audio/2021/09/07/audio_f4f4a9f3e3.mp3?filename=soft-ambience-107997.mp3" preload="auto"></audio>
<audio id="s_coin" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_ae5bff8e33.mp3?filename=coin-collect-retro-8-bit-sound-2021-1-99402.mp3" preload="auto"></audio>

<script>
const POOLS = {"ç»¼åˆ": {"weights": {"ä¸Šä¸Šç­¾": 0.1, "ä¸Šç­¾": 0.2, "ä¸­ç­¾": 0.4, "ä¸‹ç­¾": 0.2, "ä¸‹ä¸‹ç­¾": 0.1}, "items": {"ä¸Šä¸Šç­¾": [{"mv": 3, "poem": "é£æš–è‡ªå¼€èŠ±ï¼Œå–œäº‹æ‚„ç„¶è½ã€‚", "tip": "ä»Šå¤©å¯èƒ½ä¼šæœ‰ç‚¹å°ç¡®å¹¸ï¼Œåˆ«é”™è¿‡å°è§’è½é‡Œçš„å¥½äº‹ã€‚"}, {"mv": 3, "poem": "å¿ƒå®šæ°”è‡ªæµ®ï¼Œæ­¥ç¨³äº‹è‡ªæˆã€‚", "tip": "ä¿æŒä»Šå¤©çš„èŠ‚å¥æ„Ÿï¼Œç¦æ°”ä¼šæ¥æ‰¾ä½ ã€‚"}, {"mv": 3, "poem": "æ™´ç©ºæ¸¡ç™½ç¾½ï¼Œå¥½é£åŠ©é£è¡Œã€‚", "tip": "ä»Šå¤©ä½ ç‰¹åˆ«é€‚åˆåšæ¨è¿›ç±»çš„äº‹ï¼Œä¸å¦¨ä¸»åŠ¨ä¸€ç‚¹ã€‚"}, {"mv": 3, "poem": "çµå…‰ç…§å¿ƒå¤„ï¼Œç™¾äº‹çš†å¯è°ˆã€‚", "tip": "æƒ³ä¸é€šçš„ä¸œè¥¿ï¼Œä»Šå¤©çªç„¶æœ‰æœºä¼šè±ç„¶å¼€æœ—ã€‚"}, {"mv": 3, "poem": "äººå’Œæ°”äº¦å’Œï¼Œè¡Œèµ°çš†å¾—å®œã€‚", "tip": "ä½ ä¸ç¯å¢ƒä»Šå¤©ç›¸å¤„å¾—åˆšåˆšå¥½ï¼Œæ˜¯ä¸ªå¹³é¡ºé¡ºå¿ƒæ—¥ã€‚"}], "ä¸Šç­¾": [{"mv": 2, "poem": "èŠ±å¼€åŠæé¦™ï¼Œç•™ç™½äº¦æˆè¯—ã€‚", "tip": "æœ‰äº›äº‹ä¸ç”¨åšåˆ°æ»¡ï¼Œç•™ä¸€ç‚¹ç©ºé—´åè€Œæ›´å¥½ã€‚"}, {"mv": 2, "poem": "é—²äº‘ä¸å®šå‘ï¼Œäº¦éšé£æ‚ ç„¶ã€‚", "tip": "æ”¾æ¾ä¸€ç‚¹ï¼Œä»Šå¤©çš„å˜åŒ–éƒ½æ˜¯æœ‰åˆ©çš„ã€‚"}, {"mv": 2, "poem": "æœªé—®å…ˆçŸ¥æ„ï¼Œä¸€è¯­æ‹¨åƒå¿ƒã€‚", "tip": "ä»Šå¤©ç‰¹åˆ«é€‚åˆæ²Ÿé€šä¸è”ç»œï¼Œæœ‰äººå¯èƒ½ç­‰ç€ä½ å¼€å£ã€‚"}, {"mv": 2, "poem": "å°é›¨æ¶¦æ— å£°ï¼Œæ¶¦ç‰©åœ¨æ— å½¢ã€‚", "tip": "é»˜é»˜åŠªåŠ›çš„äº‹å¼€å§‹æœ‰äº†å¾®å¦™çš„åé¦ˆï¼Œä¸å¦¨ç»§ç»­åšæŒã€‚"}, {"mv": 2, "poem": "è·¯ç»•éè¿·é€”ï¼Œå›èº«äº¦æ˜¯ç¦ã€‚", "tip": "æ”¹å˜è®¡åˆ’ä¸æ˜¯åäº‹ï¼Œçµæ´»ä¼šå¸¦æ¥è½¬æœºã€‚"}], "ä¸­ç­¾": [{"mv": 1, "poem": "æ™¨å…‰å°šæ·¡ï¼Œæœªè¾¨å±±å½¢ã€‚", "tip": "ä»Šå¤©ä¸è¦æ€¥ç€å¾—å‡ºç»“è®ºï¼Œæœ‰äº›äº‹è¿˜æ²¡æµ®ç°å‡ºæ¥ã€‚"}, {"mv": 1, "poem": "é›¾é‡å¤©çŠ¹åœ¨ï¼Œå¿ƒé™è‡ªåˆ†æ˜ã€‚", "tip": "æ„Ÿè§‰ä¸æ˜æœ—æ—¶ï¼Œä¸åŠ¨ä¹Ÿæ˜¯ä¸€ç§æ™ºæ…§ã€‚"}, {"mv": 1, "poem": "äººè¨€å¤šæ‚ï¼Œè«å¬é£è¯­ã€‚", "tip": "åˆ«å¤ªåœ¨æ„åˆ«äººçš„è¯ï¼Œä¿æŒè‡ªå·±çš„åˆ¤æ–­ã€‚"}, {"mv": 1, "poem": "é—®è·¯æ— äººåº”ï¼Œè‡ªè¡Œäº¦æœ‰é€”ã€‚", "tip": "å°±ç®—æ²¡äººç»™å»ºè®®ï¼Œä½ è‡ªå·±ä¹Ÿèµ°å¾—å‡ºæ–¹å‘ã€‚"}, {"mv": 1, "poem": "æ°´æµ…æœªå¿…æ˜“æ¸¡ï¼Œäº‹ç®€ä¸å¿…è½»è§†ã€‚", "tip": "å°äº‹ä¹Ÿè¦è®¤çœŸå¯¹å¾…ï¼Œåˆ«å› è½»æ¾è€Œå‡ºé”™ã€‚"}], "ä¸‹ç­¾": [{"mv": 0, "poem": "æµ®äº‘è”½çœ¼ï¼Œéš¾è¾¨ä¸œè¥¿ã€‚", "tip": "æƒ…ç»ªå¯èƒ½ä¼šå¹²æ‰°åˆ¤æ–­ï¼Œåˆ«å†²åŠ¨åšå†³å®šã€‚"}, {"mv": 0, "poem": "å–œä¸­æœ‰ç–‘ï¼Œå‹¿è´ªå…¶æ—©ã€‚", "tip": "æœ‰äº›å¥½æ¶ˆæ¯å¯èƒ½è—ç€æ¡ä»¶ï¼Œå…ˆçœ‹æ¸…æ¥šå†é«˜å…´ã€‚"}, {"mv": 0, "poem": "è¨€æœªæˆå¥ï¼Œå·²è¢«æ›²è§£ã€‚", "tip": "ä»Šå¤©æ²Ÿé€šå¯èƒ½å®¹æ˜“å‡ºé”™ï¼Œæ…è¨€ã€‚"}, {"mv": 0, "poem": "æ—§äº‹æœªå‡€ï¼Œçƒ¦å¿µæ˜“ç”Ÿã€‚", "tip": "æœ‰äº›è¿‡å»çš„äº‹å¯èƒ½å½±å“ä½ å½“ä¸‹ï¼Œè¯•ç€æ–­èˆç¦»ã€‚"}, {"mv": 0, "poem": "ç¯ç«ä¸ç¨³ï¼Œé£å‘å¤šå˜ã€‚", "tip": "ä»Šå¤©ä¸å¤ªé€‚åˆåšé‡å¤§å†³å®šï¼Œå®œå®ˆä¸å®œæ”»ã€‚"}], "ä¸‹ä¸‹ç­¾": [{"mv": -1, "poem": "å­¤èˆŸå¤œé›¨ï¼Œéš¾è§å‰å²¸ã€‚", "tip": "ä»Šå¤©è‹¥æ„Ÿåˆ°å­¤å•æˆ–æ··ä¹±ï¼Œå…ˆç…§é¡¾å¥½è‡ªå·±çš„æƒ…ç»ªã€‚"}, {"mv": -1, "poem": "è¨€å¤šå¿…å¤±ï¼Œå¿ƒæ€¥éš¾æˆã€‚", "tip": "å¿ä¸€å¿ï¼Œæ²‰é»˜æ¯”è§£é‡Šæœ‰ç”¨ã€‚"}, {"mv": -1, "poem": "èŠ±è°¢é£ä»æ€¥ï¼Œç•™æ‹éš¾å›æ¸©ã€‚", "tip": "æ”¾ä¸‹å·²ç»æ— æœ›çš„äº‹æƒ…ï¼Œæ˜¯ç§è‡ªæˆ‘ä¿æŠ¤ã€‚"}, {"mv": -1, "poem": "å–œè¿‡åˆ™å“€è‡³ï¼Œå®œç¼“åº†åŠŸã€‚", "tip": "æœ‰å°æˆå°±å°±å¥½ï¼Œåˆ«å¤ªæ‹›æ‘‡ã€‚"}, {"mv": -1, "poem": "æ¬²ç™»é«˜å°ï¼Œè·¯å¤šè†æ£˜ã€‚", "tip": "ä»Šå¤©ä¸é€‚åˆå†’é™©ï¼Œæœ‰é£é™©çš„äº‹ç­‰ä¸€ç­‰å§ã€‚"}]}}, "è´¢è¿": {"weights": {"ä¸Šä¸Šç­¾": 0.1, "ä¸Šç­¾": 0.2, "ä¸­ç­¾": 0.4, "ä¸‹ç­¾": 0.2, "ä¸‹ä¸‹ç­¾": 0.1}, "items": {"ä¸Šä¸Šç­¾": [{"mv": 3, "poem": "ä¸œé£æ‹‚è¢–é‡‘æ°”ç”Ÿï¼Œè´¢å¸›æš—éšç¦è·¯é€šã€‚", "tip": "ä»Šæ—¥è‹¥æœ‰çµæ„ŸåŠ¨ï¼Œä¸å¦¨é¡ºåŠ¿è½»è½»æ¨ã€‚"}, {"mv": 3, "poem": "æ°´åˆ°æ¸ æˆé‡‘è‡ªèšï¼Œä¸æ±‚äº¦æœ‰æš—é¦™æ¥ã€‚", "tip": "ä¿æŒçŠ¶æ€ï¼Œå¥½è¿æ­£åœ¨æ‰¾å…¥å£ã€‚"}, {"mv": 3, "poem": "é¸¿è¿æœªè¯­å·²å…ˆåˆ°ï¼Œè·¯è½¬è´¢æ¥ä¸è§‰è¿Ÿã€‚", "tip": "åˆ«æ€¥äºè®¡åˆ’ï¼Œå…ˆç¨³ä½ä½ æ‰‹ä¸Šçš„å°åˆ©ã€‚"}, {"mv": 3, "poem": "æ—¥æš–é£æŸ”è´¢è¿è‡³ï¼Œä¸è¯­äº¦æœ‰äººç›¸è¿ã€‚", "tip": "ä»Šæ—¥é€‚åˆé™å€™æœºä¼šï¼Œä¸æŠ¢åèµ¢ã€‚"}, {"mv": 3, "poem": "å¤©å¿ƒä¸€å¿µæ‹¨äº‘å¼€ï¼Œæ¨ªè´¢éš¾æŒ¡é¡ºæ°´æ¥ã€‚", "tip": "è‹¥é‡æ„å¤–å°æ”¶è·ï¼Œè®°å¾—ç•™ç‚¹å–œæ‚¦ç»™ä¸‹æ¬¡ã€‚"}], "ä¸Šç­¾": [{"mv": 2, "poem": "è´¢ä¸´æœ‰å£°éå¤§æµªï¼Œå°æ­¥ç¼“è¡Œä¹Ÿå¯ç›ˆã€‚", "tip": "åªè¦ä½ è‚¯ç»§ç»­ï¼Œæ…¢ä¹Ÿä¸æ˜¯åäº‹ã€‚"}, {"mv": 2, "poem": "ç¦æ˜Ÿæ‚„ç…§æœªå¼ æ‰¬ï¼Œå¾®è´¢è—äºç»†èŠ‚ä¸­ã€‚", "tip": "æ³¨æ„ç”Ÿæ´»è§’è½ï¼Œå°åˆ©å¾€å¾€è—åœ¨é‚£ã€‚"}, {"mv": 2, "poem": "æ—¶æœºåŠå¯é—¨æœªå…¨ï¼Œæ¬²è¿›é¡»è§‚å¤©æœºæ—‹ã€‚", "tip": "ä»Šå¤©å…ˆçœ‹ä¸åŠ¨ï¼Œæ¯”æŠ¢å…ˆä¸€æ­¥æ›´æœ‰åº•æ°”ã€‚"}, {"mv": 2, "poem": "ç¦æœªå…¨å¼€å¿ƒå…ˆå®šï¼Œç¨³ä¸­æœ‰å–äº¦ä¸ºè´¢ã€‚", "tip": "å°èµšå°å¾—ï¼Œåˆ«ç§ä¸èµ·ç¨³å½“çš„æœºä¼šã€‚"}, {"mv": 2, "poem": "æµ®è´¢è‹¥ç°è¿˜é¡»å®ˆï¼Œè™šå®ä¹‹é—´è§çœŸæœºã€‚", "tip": "åˆ«è¢«è¡¨è±¡è¯±æƒ‘ï¼Œç¨³æ‰æœ€é‡è¦ã€‚"}], "ä¸­ç­¾": [{"mv": 1, "poem": "è´¢éšå¿ƒåŠ¨å´ä¸è‡³ï¼Œè¡Œæ­¢ä¹‹é—´çŠ¹æœªæ˜ã€‚", "tip": "è‹¥å¿ƒä¹±ï¼Œä¸å¦‚ä»Šå¤©ä¸ä¸‹å†³å®šã€‚"}, {"mv": 1, "poem": "å¸‚å£°è™½åŠ¨åˆ©éš¾æˆï¼Œå®œå®ˆä¸å®œæ”»å…¶é”‹ã€‚", "tip": "ä»Šå¤©çš„ä½ é€‚åˆä½è°ƒä¸€ç‚¹ï¼Œä¸é€‚åˆæ”¾æ‰‹ä¸€æã€‚"}, {"mv": 1, "poem": "è·¯è½¬ä¸æ˜é£æœªæ­¢ï¼Œå°åœåŠæ­¥äº¦æ— ä¼¤ã€‚", "tip": "ä¸å‰è¿›ä¹Ÿä¸æ˜¯å¤±è´¥ï¼Œæ˜¯ç­‰å¾…èŠ‚å¥å¯¹ä¸Šã€‚"}, {"mv": 1, "poem": "é“¶æ°”æœªèšå¿ƒå…ˆä¹ï¼Œæ¬²ä¸ºåŠ›å°é“éš¾é€šã€‚", "tip": "ä¸å…¶ç„¦è™‘ï¼Œä¸å¦‚å®‰é™ä¸€ä¼šå„¿å†çœ‹å±€åŠ¿ã€‚"}, {"mv": 1, "poem": "ç©ºè½¬æœªç”Ÿå®è´¢åŠ¨ï¼Œç§¯æ°”å¾…è¡Œæ–¹ä¸ºæ—¶ã€‚", "tip": "åˆ«æ€¥ï¼Œç­‰çµæ„Ÿå’ŒåŠ¨åŠ›éƒ½å›æ¥å†åŠ¨æ‰‹ã€‚"}], "ä¸‹ç­¾": [{"mv": 0, "poem": "é‡‘å…‰é¿è¡Œè´¢æ°”æµ…ï¼Œå°‘åŠ¨ä¸ºå®‰å‹¿å¦„è°‹ã€‚", "tip": "ä»Šå¤©é€‚åˆèŠ‚æµè€Œéå¼€æºï¼Œåˆ«å†²åŠ¨èŠ±é’±ã€‚"}, {"mv": 0, "poem": "é£æ­‡è´¢å°½å¸‚å£°å“‘ï¼Œæœªå¯å¦„åŠ¨å›¾é‡‘æã€‚", "tip": "è¶é™æ—¶æ•´ç†ä¸€ä¸‹è´¦æˆ·ï¼Œæ¯”ä¹±å†²æ›´æœ‰ç”¨ã€‚"}, {"mv": 0, "poem": "è°‹è´¢ä¸æˆåå¤±æ°”ï¼Œå¼ºæ±‚ä¸è‹¥å®ˆé™å¿ƒã€‚", "tip": "è‹¥äº‹ä¸é¡ºï¼Œå…ˆé€€ä¸€æ­¥ï¼Œä¹Ÿè®¸èƒ½æ¢æ¥åˆ«çš„è¿æ°”ã€‚"}, {"mv": 0, "poem": "å°åˆ©æœ‰æŸä¸åˆ’ç®—ï¼Œå›å­è—å™¨å¾…æ¥æ—¶ã€‚", "tip": "ä»Šå¤©ä¸é€‚åˆä¹°ä¹°ä¹°ï¼Œé€‚åˆå…³æ‰æ‰€æœ‰ä¿ƒé”€æ¨é€ã€‚"}, {"mv": 0, "poem": "å¤©æœºæœªé€å‹¿å¼ºæ±‚ï¼Œæš‚å€Ÿç©ºé—¨å…»è´¢æ ¹ã€‚", "tip": "åšå¥½åŸºæœ¬åŠŸï¼Œæ¯”è¿½çŸ­è´¢æ›´é‡è¦ã€‚"}], "ä¸‹ä¸‹ç­¾": [{"mv": -1, "poem": "ç ´æ°”å…¥å®«è¡Œå¤±åŠ¿ï¼ŒåŠ¨åˆ™è´¢æ•£è«å¼ºè¡Œã€‚", "tip": "è¶Šæƒ³è¡¥æ•‘è¶Šäºï¼Œä¸å¦‚ä»Šå¤©ä»€ä¹ˆéƒ½åˆ«åšã€‚"}, {"mv": -1, "poem": "è´¢é—¨æœªå¯ç¦æ˜Ÿè¿œï¼Œç©ºå–œä¸€åœºæœ€ä¸ºè‹¦ã€‚", "tip": "æ¥å—ä»Šå¤©çš„â€œç©ºæ‰‹è€Œå½’â€ï¼Œæœ‰æ—¶æ˜¯ä¸ºäº†åå¼¹åŠ›æ›´å¼ºã€‚"}, {"mv": -1, "poem": "å¤šæ¬²ä¹±å¿ƒè´¢è·¯é—­ï¼Œä¸èˆä¸èšäº¦ä¸ºå¸¸ã€‚", "tip": "æƒ³è¦å¤ªå¤šåè€Œæä¸åˆ°ï¼Œæ”¶ä¸€æ”¶æ¬²æœ›è¯•è¯•çœ‹ã€‚"}, {"mv": -1, "poem": "é“¶ç«å¾®å…‰éš¾ç‚¹ç¯ï¼Œç©ºè¯éš¾æ¢çœŸé‡‘å£°ã€‚", "tip": "å°‘è°ˆç†è´¢ç»ï¼Œå¤šåšå®¶åŠ¡æ´»ï¼Œå¯èƒ½æ›´å®åœ¨ã€‚"}, {"mv": -1, "poem": "è¿ä½ä¸è¯­ç¦éš¾å¬ï¼Œå¼ºè¨€åæ‹›è‡ªå¿ƒæƒŠã€‚", "tip": "è´¢è¿èµ°ä½æ—¶ï¼Œå¤šæ²‰é»˜ï¼Œå¤šå‚¨èƒ½ï¼Œåˆ«è‡ªæˆ‘æ‰“è„¸ã€‚"}]}}, "æ„Ÿæƒ…": {"weights": {"ä¸Šä¸Šç­¾": 0.1, "ä¸Šç­¾": 0.2, "ä¸­ç­¾": 0.4, "ä¸‹ç­¾": 0.2, "ä¸‹ä¸‹ç­¾": 0.1}, "items": {"ä¸Šä¸Šç­¾": [{"mv": 3, "poem": "èŠ±æœªè¯­æƒ…å·²è‡³ï¼Œé£æ¥äººäº¦æ¥ã€‚", "tip": "ä»Šå¤©è‹¥æœ‰äººä¸»åŠ¨é è¿‘ï¼Œä¸å¦¨æ…¢æ…¢å›åº”ã€‚"}, {"mv": 3, "poem": "æ¡ƒå¼€ä¸œå¢™å¤–ï¼Œç¬‘è¯­è‡ªæˆåŒã€‚", "tip": "ä¿æŒä½ çš„è‡ªç„¶ï¼Œå¸å¼•åŠ›å·²ç»åœ¨ä½ èº«ä¸Šäº†ã€‚"}, {"mv": 3, "poem": "æœ‰ç¼˜äººä¸è¿œï¼Œæ„¿å¿ƒä¼¼é£è¡Œã€‚", "tip": "ç»™ç‚¹ç©ºé—´ï¼Œä¹Ÿè®¸æŸäººå·²ç»åœ¨å‘ä½ é è¿‘ã€‚"}, {"mv": 3, "poem": "æœˆæ»¡äººé—´é™ï¼Œæœ‰æƒ…è‡ªä¼šæ¥ã€‚", "tip": "åˆ«æ€¥ç€é—®ç»“æœï¼Œå¯¹çš„å¿ƒä¼šè‡ªå·±æ‰¾ä½ ã€‚"}, {"mv": 3, "poem": "çœ¼åº•è—æ˜Ÿè¾°ï¼Œå¿ƒä¸Šæœ‰äººè¡Œã€‚", "tip": "å¦‚æœä½ æœ‰å–œæ¬¢çš„äººï¼Œä»Šå¤©é€‚åˆä¸»åŠ¨ä¸€ç‚¹ç‚¹ã€‚"}], "ä¸Šç­¾": [{"mv": 2, "poem": "æƒ…ç”Ÿæœªå®šå½±å¾®æ˜ï¼Œå¿ƒäº‹éšé£è¿‘ã€‚", "tip": "åˆ«æ€¥ç€è´´æ ‡ç­¾ï¼Œæ„Ÿè§‰æ­£åœ¨æ…¢æ…¢å‘èŠ½ã€‚"}, {"mv": 2, "poem": "ä¸€è¯­è¯¯çº¢å°˜ï¼Œä¸‰æ€æ–¹å¯äº²ã€‚", "tip": "è¯´è¯ç•™ä¸€å£æ°”ï¼Œåˆ«å¤ªå¿«è°ˆå¿ƒåº•äº‹ã€‚"}, {"mv": 2, "poem": "é™çœ‹èŠ±å¼€æ—¶ï¼Œæƒ…ç¼˜ä¸å¼ºæ±‚ã€‚", "tip": "ç¼“ä¸€ç‚¹ï¼Œå…¶å®ä¸æ˜¯æ²¡å›åº”ï¼Œæ˜¯ä½ è¿˜æ²¡å‘ç°ã€‚"}, {"mv": 2, "poem": "æœˆä¸‹å¾®å…‰ç…§ï¼Œä¸¤å¿ƒæœªå…¨é€šã€‚", "tip": "å¯ä»¥æš—ç¤ºï¼Œä½†åˆ«é€¼é—®ï¼Œç»™å½¼æ­¤ç‚¹ä½™åœ°ã€‚"}, {"mv": 2, "poem": "é£çº¦æ‚„ç„¶æ¥ï¼Œæƒ…åŠ¨éè¡¨ç™½ã€‚", "tip": "æœ‰äº›å¥½æ„Ÿï¼Œä¸è¯´ä¹Ÿèƒ½è¢«æ„Ÿå—åˆ°ã€‚"}], "ä¸­ç­¾": [{"mv": 1, "poem": "å¿ƒæ¹–æ— æ³¢æµªï¼Œé•œä¸­æœˆä¸æ·±ã€‚", "tip": "ä»Šå¤©é€‚åˆæ¸…ç©ºæƒ…ç»ªï¼Œåˆ«å¤ªæ‰§ç€å›éŸ³ã€‚"}, {"mv": 1, "poem": "æ—§æ¢¦æœªå¤®ï¼Œæƒ…ç»ªå°šæœªå½’ä½ã€‚", "tip": "ä¸ç”¨æ€¥ç€ç¿»æ—§é¡µï¼Œä¹Ÿåˆ«ç€æ€¥ç¿»æ–°ç¯‡ã€‚"}, {"mv": 1, "poem": "æ¬²è¯­è¿˜ä¼‘æ—¶ï¼Œæƒ…æœªåˆ°ç¼˜æœªå®šã€‚", "tip": "è§‚å¯Ÿæ¯”å†²åŠ¨é‡è¦ï¼Œè¯´å‡ºå£ä¹‹å‰å†ç­‰ç­‰ã€‚"}, {"mv": 1, "poem": "ä¸‰åˆ†å–œæ„è—ï¼Œä¸¤åˆ†è¿Ÿç–‘æ‹¦ã€‚", "tip": "æœ‰æ„Ÿè§‰å°±æ‰¿è®¤ï¼Œä½†åˆ«æ€¥ç€è¡ŒåŠ¨ã€‚"}, {"mv": 1, "poem": "ç›¸æ€æœªæ»¡æœˆï¼Œç›¸å¤„ä¸æˆè¯—ã€‚", "tip": "æ„Ÿæƒ…è¿™äº‹ï¼Œä¸ç¡®å®šå°±åˆ«å¼ºè¡Œæµªæ¼«ã€‚"}], "ä¸‹ç­¾": [{"mv": 0, "poem": "ç¼˜è·¯å¤šæ­§å£ï¼Œå¿ƒé—¨é—­æœªå¼€ã€‚", "tip": "ä»Šå¤©å¯èƒ½ä¸å¤ªé€‚åˆè°ˆæƒ…è¯´çˆ±ï¼Œå†·é™ä¼˜å…ˆã€‚"}, {"mv": 0, "poem": "æƒ…çº¿ç»•æŒ‡ä¹±ï¼Œæ—§äº‹ä¸Šå¿ƒå¤´ã€‚", "tip": "ä½ è¿˜æ²¡æ”¾ä¸‹ä¹‹å‰çš„æ•…äº‹ï¼Œåˆ«éª—è‡ªå·±ã€‚"}, {"mv": 0, "poem": "å–œæœªå®æƒ…æœªçœŸï¼Œè™šå£°æœ€åŠ¨äººã€‚", "tip": "æœ‰äººå¯¹ä½ å¤ªå¥½ï¼Œåè€Œå€¼å¾—å¤šç•™å¿ƒã€‚"}, {"mv": 0, "poem": "åŠé€”æ— äººå€™ï¼Œç©ºé˜¶å¤œè‡ªæ·±ã€‚", "tip": "åˆ«ä¸ºäº†å­¤å•è€Œè”ç»œï¼Œä¸å€¼å¾—ã€‚"}, {"mv": 0, "poem": "è¨€æµ…æƒ…æœªé€ï¼Œç›¸é¡¾ä¸¤ä¸æ˜ã€‚", "tip": "æƒ³æ¸…æ¥šä½ æ˜¯å–œæ¬¢ä»–ï¼Œè¿˜æ˜¯å–œæ¬¢è¢«å–œæ¬¢ã€‚"}], "ä¸‹ä¸‹ç­¾": [{"mv": -1, "poem": "å¿ƒæœ‰é£é›·åŠ¨ï¼Œäººæ— åº”ç­”å£°ã€‚", "tip": "æƒ…ç»ªåˆ«ç™½ç»™ï¼Œä»Šå¤©çš„å›åº”ä¸ä¼šå¦‚ä½ é¢„æœŸã€‚"}, {"mv": -1, "poem": "çˆ±æ¬²è‹¥æ‰§å¿µï¼Œè¶Šæ±‚è¶Šæˆç©ºã€‚", "tip": "åˆ«ç›¯ç€ä¸€ä¸ªæ²¡å›åº”çš„äººï¼Œçœ‹å›è‡ªå·±ã€‚"}, {"mv": -1, "poem": "è¯æ­¢å”‡è¾¹å†·ï¼Œæƒ…è½çº¸ä¸Šç°ã€‚", "tip": "æƒ³è¯´çš„åˆ«è¯´äº†ï¼Œç•™ç»™æ„¿æ„å¬çš„äººã€‚"}, {"mv": -1, "poem": "ç¼˜èµ·æ— é—¨ï¼Œå¿ƒåŠ¨é”™æ—¶ã€‚", "tip": "ä¸ä»£è¡¨æ²¡ç¼˜ï¼Œåªæ˜¯ä¸åœ¨ä»Šå¤©ã€‚"}, {"mv": -1, "poem": "æƒ…æ·±ä¸å¯¿ï¼Œæ‰§è€…æœ€ä¼¤ã€‚", "tip": "åœä¸€ä¸‹ï¼Œåˆ«å†åå¤ä¼¤è‡ªå·±ã€‚"}]}}, "äº‹ä¸š": {"weights": {"ä¸Šä¸Šç­¾": 0.1, "ä¸Šç­¾": 0.2, "ä¸­ç­¾": 0.4, "ä¸‹ç­¾": 0.2, "ä¸‹ä¸‹ç­¾": 0.1}, "items": {"ä¸Šä¸Šç­¾": [{"mv": 3, "poem": "é£èµ·äº‘æ‰¬å±•å¤§å¿—ï¼Œä¸‡æœºä¿±å¤‡é¡ºæ—¶ä¹˜ã€‚", "tip": "å¤§å±€å·²å°±ç»ªï¼Œé€‚åˆæ¨è¿›é‡è¦è®¡åˆ’ã€‚"}, {"mv": 3, "poem": "é”¦è·¯å¼€å‰ç¨‹ï¼Œè´µäººæŠ¤å·¦å³ã€‚", "tip": "æœ‰äººæ­£æš—ä¸­æ”¯æŒä½ ï¼Œä¸å¦¨å¤§èƒ†ä¸€ç‚¹ã€‚"}, {"mv": 3, "poem": "æ˜Ÿæ²‰ç­–åŠ¨åƒæœºè½¬ï¼Œä¸€è¯­æƒŠäººå››åº§å¬ã€‚", "tip": "ä½ ä»Šå¤©çš„è¯ã€è¡ŒåŠ¨ï¼Œå¾ˆå¯èƒ½æˆä¸ºå…³é”®å½±å“ç‚¹ã€‚"}, {"mv": 3, "poem": "è·ƒé©¬æ¨ªç©ºå¿—ä¸å‡¡ï¼Œä¸‡ä»é«˜æ¥¼èµ·è¶³é—´ã€‚", "tip": "ä¸æ€•ä»ä½å¼€å§‹ï¼Œæœ‰åŠ¿å°±æœ‰æœªæ¥ã€‚"}, {"mv": 3, "poem": "æ—¥ç…§é•¿å·é‡‘æ°”åŠ¨ï¼Œä¸€å¿µå¯è¡Œè½¬ä¹¾å¤ã€‚", "tip": "è‹¥ä½ æ­£çŠ¹è±«ä¸€äº‹ï¼Œä»Šæ—¥å¯ä»¥å®šå¤ºäº†ã€‚"}], "ä¸Šç­¾": [{"mv": 2, "poem": "æ°´æ¸…çŸ³è§é“åˆæ˜ï¼Œä¸äº‰è‡ªæœ‰è·¯æµ®å…‰ã€‚", "tip": "è¶Šæ¸…æ™°è‡ªå·±è¦ä»€ä¹ˆï¼Œè¶Šå®¹æ˜“èµ°å‡ºå¥½å±€ã€‚"}, {"mv": 2, "poem": "é—²äº‘è™½ç¼“è¡Œç»ˆç¨³ï¼Œä¸é€Ÿäº¦èƒœäº‰å…ˆäººã€‚", "tip": "åˆ«æ€•è¿›å±•æ…¢ï¼Œä½ èµ°çš„æ¯”ä½ ä»¥ä¸ºçš„è¿œã€‚"}, {"mv": 2, "poem": "è—é”‹æœªæ˜¾æ„å·²æˆï¼Œåå‘ä¹‹åŠ¿å¯å›¾å¼ºã€‚", "tip": "ä½ è¿˜æ²¡çˆ†å‘è€Œå·²ï¼Œå®åŠ›å·²ç»æ…¢æ…¢èšèµ·ã€‚"}, {"mv": 2, "poem": "ä¸‡è±¡æœªåŠ¨å¿ƒå…ˆé™ï¼Œæœ‰æœºå¯å¾…å‹¿å¦„è¡Œã€‚", "tip": "çœ‹æ¸…å½¢åŠ¿æ‰åŠ¨ï¼Œæ˜¯ä½ æœ€å¥½çš„èŠ‚å¥ã€‚"}, {"mv": 2, "poem": "å±±é«˜æœ›è¿œé€”æœªç©·ï¼Œç¨³å­—å½“å¤´ç¦è‡ªç”Ÿã€‚", "tip": "ä»Šå¤©ä¸è¦èµŒå±€ï¼Œå®œå®ˆä¸ºä¸Šã€‚"}], "ä¸­ç­¾": [{"mv": 1, "poem": "å±€å¼€ä¸‰åˆ†è·¯ï¼Œå¿ƒä¹±éš¾çŸ¥æœºã€‚", "tip": "å¦‚æœä½ ç°åœ¨çœ‹ä¸æ¸…æ–¹å‘ï¼Œå…ˆä¼‘æ•´ä¸€å¤©ã€‚"}, {"mv": 1, "poem": "è°‹äº‹åˆæˆæœªæˆå±€ï¼Œä¸€ä¸¾ä¸€åŠ¨çš†ä¸ºæ ¹ã€‚", "tip": "å°å†³å®šä¹Ÿæœ‰å½±å“ï¼Œç»†èŠ‚å€¼å¾—ä½ é‡çœ‹ä¸€éã€‚"}, {"mv": 1, "poem": "å¿—åŠ¨è€Œè·¯é™ï¼Œè¡Œè¿Ÿéå¤±ä¹Ÿã€‚", "tip": "åˆ«è¯¯ä¼šâ€œæ²¡åŠ¨é™â€æ˜¯åäº‹ï¼Œæœ‰æ—¶å€™æ˜¯åœ¨é“ºæ’ã€‚"}, {"mv": 1, "poem": "ä¸€å¿µæœªå®šç™¾äº‹éš¾ï¼Œå…ˆæ±‚å¿ƒå®šå†è°ˆå›¾ã€‚", "tip": "ä»Šå¤©çš„å…³é”®ï¼Œæ˜¯æƒ³æ¸…æ¥šè€Œä¸æ˜¯åšå†³å®šã€‚"}, {"mv": 1, "poem": "è™šåæ»¡å¸­ç©ºåå®¢ï¼Œå®äº‹è½åœ°æ— äººçŸ¥ã€‚", "tip": "åˆ«è¢«å¤¸å¥–å†²æ˜å¤´ï¼Œä¸“æ³¨å®é™…ã€‚"}], "ä¸‹ç­¾": [{"mv": 0, "poem": "å‰è·¯å¤šé›¾ï¼Œè«æ‰§æ—§ç¯ã€‚", "tip": "ä½ åŸæœ¬çš„è®¡åˆ’ä¸é€‚ç”¨äº†ï¼Œå…ˆæš‚åœã€‚"}, {"mv": 0, "poem": "è°‹è€Œéš¾åŠ¨ï¼ŒåŠ›ä¸æ•Œæ—¶ã€‚", "tip": "ä¸æ˜¯ä½ ä¸è¡Œï¼Œæ˜¯æ—¶æœºè¿˜æ²¡æ¥ï¼Œå…ˆç­‰ã€‚"}, {"mv": 0, "poem": "å¼ºè¡Œç ´å±€åç»“ç»³ï¼Œå®œé€€åŠæ­¥æ¢æ˜ç¯ã€‚", "tip": "ç¡¬å†²çš„äº‹ä»Šå¤©åšä¸äº†ï¼Œä¸å¦‚æ¢ä¸ªåˆ‡å£ã€‚"}, {"mv": 0, "poem": "å±€æœªå…¨æˆæ¬²é€Ÿè´¥ï¼Œç§¯åŠ›å¾…æ—¶è‡ªåŒ–é¾™ã€‚", "tip": "å†å¤šä¸€ç‚¹å‡†å¤‡ï¼Œå¯èƒ½é¿å…ä¸€æ¬¡ç¿»è½¦ã€‚"}, {"mv": 0, "poem": "ç©ºè°ˆé€ å±€æ— å®å™¨ï¼Œæˆäº‹éå£ä¸­æ¥ã€‚", "tip": "ä»Šå¤©è¦è½åœ°ï¼Œåˆ«åªè®²ç†æƒ³ã€‚"}], "ä¸‹ä¸‹ç­¾": [{"mv": -1, "poem": "å‰ç¼˜éš¾ç»­åå±€æœªç”Ÿï¼ŒåŠ¨ä¹‹åˆ™ä¼¤ã€‚", "tip": "æ—§è·¯èµ°ä¸é€šï¼Œæ–°è·¯è¿˜æ²¡å‡ºç°ï¼Œä»Šå¤©ä¸é€‚åˆå†³å®šæ–¹å‘ã€‚"}, {"mv": -1, "poem": "ç«å€™æœªç†Ÿæ€¥æ–­åˆ™ç„¦ï¼Œå¾’æ·»çƒ¦å¿§ã€‚", "tip": "å¦‚æœä½ åœ¨è€ƒè™‘è·³æ§½ã€è¾èŒï¼Œä»Šå¤©æœ€å¥½å…ˆå¿ä¸€å¿ã€‚"}, {"mv": -1, "poem": "åŠ›æ•£å¿—æµ®ç™¾äº‹éš¾æˆï¼Œä¸€é™è€Œå¾—å…¨å±€å®‰ã€‚", "tip": "åˆ«èƒ¡æ€ä¹±æƒ³ï¼Œè®©è‡ªå·±æ²‰ä¸‹æ¥æ˜¯é¦–è¦ã€‚"}, {"mv": -1, "poem": "äººå¿ƒä¹–èˆ›ï¼Œæ˜¯éæš—æ¶Œã€‚", "tip": "èŒåœºä»Šå¤©å¯èƒ½æš—æ¶Œå¤šï¼Œå°‘è¯´è¯å¤šçœ‹äººã€‚"}, {"mv": -1, "poem": "åˆ©å°½é“æ•£ï¼Œä¸å¦‚å½’å¿ƒã€‚", "tip": "æœ‰äº›åˆä½œæˆ–è®¸è¯¥æ”¶æ‰‹ï¼Œåˆ«æµªè´¹åŠ›æ°”åœ¨æ— æ•ˆäº‹ä¸Šã€‚"}]}}};
const CARDS = [{"ch": "å¿ƒ", "rar": "R"}, {"ch": "æƒ³", "rar": "R"}, {"ch": "äº‹", "rar": "R"}, {"ch": "æˆ", "rar": "R"}, {"ch": "ä¸‡", "rar": "R"}, {"ch": "å¦‚", "rar": "R"}, {"ch": "æ„", "rar": "R"}, {"ch": "ä¸œ", "rar": "R"}, {"ch": "æµ·", "rar": "R"}, {"ch": "æ­¥", "rar": "R"}, {"ch": "é«˜", "rar": "R"}, {"ch": "å‡", "rar": "R"}, {"ch": "è…¾", "rar": "R"}, {"ch": "å››", "rar": "R"}, {"ch": "å…¨", "rar": "R"}, {"ch": "åŒ", "rar": "R"}, {"ch": "æ°”", "rar": "R"}, {"ch": "æ´‹", "rar": "R"}, {"ch": "ç¦", "rar": "SR"}, {"ch": "è´¢", "rar": "SR"}, {"ch": "æº", "rar": "SR"}, {"ch": "æ»š", "rar": "SR"}, {"ch": "å–œ", "rar": "SR"}, {"ch": "ç¦„", "rar": "SSR"}, {"ch": "å‰", "rar": "SSR"}, {"ch": "æ˜Ÿ", "rar": "SSR"}, {"ch": "é¾™", "rar": "SSR"}, {"ch": "ç¦§", "rar": "SSR"}, {"ch": "éº’", "rar": "SSSR"}, {"ch": "éºŸ", "rar": "SSSR"}, {"ch": "ç¥¥", "rar": "SSSR"}, {"ch": "å‘ˆ", "rar": "SSSR"}];
const IDIOMS = [{"name": "å¿ƒæƒ³äº‹æˆ", "chars": ["å¿ƒ", "æƒ³", "äº‹", "æˆ"], "tier": "R", "yield": 1}, {"name": "ä¸‡äº‹å¦‚æ„", "chars": ["ä¸‡", "äº‹", "å¦‚", "æ„"], "tier": "R", "yield": 1}, {"name": "ç¦å¦‚ä¸œæµ·", "chars": ["ç¦", "å¦‚", "ä¸œ", "æµ·"], "tier": "SR", "yield": 3}, {"name": "è´¢æºæ»šæ»š", "chars": ["è´¢", "æº", "æ»š", "æ»š"], "tier": "SR", "yield": 3}, {"name": "å‰æ˜Ÿé«˜ç…§", "chars": ["å‰", "æ˜Ÿ", "é«˜", "ç…§"], "tier": "SSR", "yield": 6}, {"name": "æ­¥æ­¥é«˜å‡", "chars": ["æ­¥", "æ­¥", "é«˜", "å‡"], "tier": "R", "yield": 1}, {"name": "é¾™è…¾å››æµ·", "chars": ["é¾™", "è…¾", "å››", "æµ·"], "tier": "SSR", "yield": 6}, {"name": "ç¦ç¦„åŒå…¨", "chars": ["ç¦", "ç¦„", "åŒ", "å…¨"], "tier": "SSR", "yield": 6}, {"name": "å–œæ°”æ´‹æ´‹", "chars": ["å–œ", "æ°”", "æ´‹", "æ´‹"], "tier": "SR", "yield": 3}, {"name": "éº’éºŸå‘ˆç¥¥", "chars": ["éº’", "éºŸ", "å‘ˆ", "ç¥¥"], "tier": "SSSR", "yield": 10}];
const rarityWeights = {R:0.7, SR:0.2, SSR:0.09, SSSR:0.01};

const state = {mv:0,gold:0,goldYield:0,inv:{},idiomDone:{},lastHarvest:0,prevDraw:null,canRedo:false,curPool:"ç»¼åˆ"};

function save(){ localStorage.setItem("qianyiqian_v04", JSON.stringify(state)); }
function load(){ try{ Object.assign(state, JSON.parse(localStorage.getItem("qianyiqian_v04")||"{}")); }catch(e){} }

function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1500); }
function play(id){ const a=document.getElementById(id); if(!a) return; try{ a.currentTime=0; a.play(); }catch(e){} }

function updateUI(){
  document.getElementById('mv').textContent = state.mv;
  document.getElementById('gold').textContent = state.gold;
  document.getElementById('gyield').textContent = state.goldYield;
  document.getElementById('lastHarvest').textContent = state.lastHarvest? new Date(state.lastHarvest).toLocaleString() : "â€”";
  renderInv(); renderIdioms();
  // tabs
  const poolsDiv = document.getElementById('pools'); poolsDiv.innerHTML="";
  Object.keys(POOLS).forEach(name=>{
    const b=document.createElement('div'); b.className='tab'+(name===state.curPool?' active':''); b.textContent=name;
    b.addEventListener('click',()=>{ state.curPool=name; updateUI(); save(); });
    poolsDiv.appendChild(b);
  });
  document.getElementById('redoBtn').disabled = !state.canRedo;
  document.getElementById('result').style.display = state.prevDraw? 'block':'none';
}

function pickLevel(weights){
  const r=Math.random(); let acc=0;
  for(const k of Object.keys(weights)){ acc+=weights[k]; if(r<=acc) return k; }
  return "ä¸­ç­¾";
}
function drawFromPool(name){
  const pool=POOLS[name]||POOLS["ç»¼åˆ"];
  const level=pickLevel(pool.weights);
  const arr=pool.items[level];
  const it=arr[Math.floor(Math.random()*arr.length)];
  return Object.assign({level}, it);
}

function onRitual(){
  document.getElementById('ritual').style.display='flex';
  play('s_qin');
}
function onStartRitual(){ document.getElementById('ritual').style.display='none'; onDraw(); }

function onDraw(){
  const res = drawFromPool(state.curPool);
  state.prevDraw = res; state.canRedo=true;
  document.getElementById('poem').textContent = res.poem;
  document.getElementById('tip').textContent = res.tip;
  document.getElementById('tier').textContent = res.level;
  document.getElementById('mvDelta').textContent = (res.mv>=0?'+':'')+res.mv;
  document.getElementById('result').style.display='block';
  play('s_bell'); save(); updateUI();
}

function onAccept(){
  if(!state.prevDraw) return;
  state.mv += state.prevDraw.mv;
  toast('å‘½è¿å€¼å˜åŒ– ' + (state.prevDraw.mv>=0?'+':'') + state.prevDraw.mv);
  state.prevDraw=null; state.canRedo=false; save(); updateUI();
}

function onRedo(){
  if(!state.canRedo){ toast('æœ¬æ¬¡å·²é‡ç­¾è¿‡'); return; }
  const res = drawFromPool(state.curPool);
  state.prevDraw=res; state.canRedo=false;
  document.getElementById('poem').textContent = res.poem;
  document.getElementById('tip').textContent = res.tip;
  document.getElementById('tier').textContent = res.level;
  document.getElementById('mvDelta').textContent = (res.mv>=0?'+':'')+res.mv;
  play('s_bell'); save(); updateUI();
}

function weightedRarity(){
  const r=Math.random(); let acc=0;
  for(const k of Object.keys(rarityWeights)){ acc+=rarityWeights[k]; if(r<=acc) return k; }
  return 'R';
}
function drawCard(){
  if(state.mv<10){ toast('å‘½è¿å€¼ä¸è¶³ï¼ˆéœ€è¦10ï¼‰'); return; }
  state.mv -= 10;
  for(let i=0;i<8;i++){ // try a few times
    const rar = weightedRarity();
    const cand = CARDS.filter(c=>c.rar===rar);
    if(cand.length){ const c=cand[Math.floor(Math.random()*cand.length)];
      state.inv[c.ch]=(state.inv[c.ch]||0)+1;
      document.getElementById('cardHint').innerHTML = 'è·å¾—å­—å¡ï¼š<b class="glow">'+c.ch+'</b>ï¼ˆ'+c.rar+'ï¼‰';
      play('s_coin'); break;
    }
  }
  recomputeIdioms(); save(); updateUI();
}

function renderInv(){
  const box=document.getElementById('inv'); box.innerHTML="";
  const order={SSSR:0,SSR:1,SR:2,R:3};
  CARDS.slice().sort((a,b)=> order[a.rar]-order[b.rar] || a.ch.localeCompare(b.ch)).forEach(c=>{
    const d=document.createElement('div'); d.className='cell rar-'+c.rar;
    const cnt=state.inv[c.ch]||0;
    d.innerHTML = '<div class="rar">'+c.rar+'</div><div>'+c.ch+'</div><div style="font-size:12px;color:#777">'+cnt+'</div>';
    box.appendChild(d);
  });
}

function recomputeIdioms(){
  let yieldSum=0;
  for(const id of IDIOMS){
    const need={}; id.chars.forEach(ch=> need[ch]=(need[ch]||0)+1 );
    const hasAll = Object.entries(need).every(([ch,n])=> (state.inv[ch]||0)>=n);
    if(hasAll) state.idiomDone[id.name]=true;
    if(state.idiomDone[id.name]) yieldSum += id.yield;
  }
  state.goldYield = yieldSum;
}

function renderIdioms(){
  const box=document.getElementById('idiomBox'); box.innerHTML="";
  IDIOMS.forEach(id=>{
    const done=!!state.idiomDone[id.name];
    const div=document.createElement('div'); div.className='idiom'+(done?' done':'');
    div.innerHTML = '<div><b>'+id.name+(done?' âœ…':'')+'</b><br><small>æ‰€éœ€ï¼š'+id.chars.join(' ')+' ï½œ ç‚¹äº® +'+id.yield+' æ—¥äº§</small></div><div><span class="btn inkbtn">ç‚¹äº®</span></div>';
    const btn=div.querySelector('.btn');
    btn.disabled = done;
    btn.addEventListener('click',()=>{
      const need={}; id.chars.forEach(ch=> need[ch]=(need[ch]||0)+1 );
      const ok = Object.entries(need).every(([ch,n])=> (state.inv[ch]||0)>=n);
      if(!ok){ toast('å­—å¡ä¸è¶³'); return; }
      state.idiomDone[id.name]=true; recomputeIdioms(); save(); updateUI(); play('s_coin'); toast('ç‚¹äº®ã€Œ'+id.name+'ã€');
    });
    box.appendChild(div);
  });
}

function harvest(){
  if(state.goldYield<=0){ toast('å…ˆç‚¹äº®ä¸€æ¡æˆè¯­è¯•è¯•'); return; }
  const now=Date.now(), day=24*60*60*1000;
  if(state.lastHarvest && now-state.lastHarvest<day){ const left=Math.ceil((day-(now-state.lastHarvest))/3600000); toast('å°šæœªåˆ°æ”¶å‰²æ—¶é—´ï¼ˆçº¦ '+left+' å°æ—¶åï¼‰'); return; }
  state.gold += state.goldYield; state.lastHarvest=now; save(); updateUI(); play('s_coin'); toast('æ”¶å‰²æˆåŠŸ +'+state.goldYield+' é‡‘ç¨»');
}

document.addEventListener('DOMContentLoaded', ()=>{
  load(); recomputeIdioms(); updateUI();
  document.getElementById('ritualBtn').addEventListener('click', onRitual);
  document.getElementById('startRitual').addEventListener('click', onStartRitual);
  document.getElementById('drawBtn').addEventListener('click', onDraw);
  document.getElementById('redoBtn').addEventListener('click', onRedo);
  document.getElementById('harvest').addEventListener('click', harvest);
  document.getElementById('drawCard').addEventListener('click', drawCard);
});
</script>
</body>
</html>
